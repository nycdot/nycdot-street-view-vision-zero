<!doctype html>
<!--[if lt IE 7]>  <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>shareabouts sv vision zero</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <link href="bower_components/shareabouts-js/src/styles/shareabouts.css" rel="stylesheet" />
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
    <script src="bower_components/modernizr/modernizr.js"></script>

  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <div class="shareabouts-location-map"></div>
    <div class="shareabouts-streetview-container">
      <div class="shareabouts-streetview-map"></div>
      <div class="shareabouts-streetview"></div>
    </div>

    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/1.8.0/backbone.marionette.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false" type="text/javascript"></script>

    <script src="//rawgit.com/openplans/gatekeeper/gh-pages/gatekeeper.js"></script>

    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/handlebars/handlebars.js"></script>
    <script src="bower_components/swag/lib/swag.js"></script>
    <script src="bower_components/moment/moment.js"></script>
    <script src="bower_components/shareabouts-js/src/utils.js"></script>
    <script src="bower_components/shareabouts-js/src/models.js"></script>
    <script src="bower_components/shareabouts-js/src/streetview.js"></script>

    <script src="scripts/handlebars-helpers.js"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <script id="place-detail" type="text/x-handlebars-template">
      <section class="promotion clearfix">
        <div class="support"></div>
        <div class="social">
          <ul class="sharing unstyled-list">
            <li class="share-link share-twitter"><a href="https://twitter.com/intent/tweet?hashtags=VisionZero&url={{ place_url id }}&text=I shared my knowledge to help make Vision Zero a reality in NYC" target="_blank" data-shareto="twitter">Tweet This</a></li>
            <li class="share-link share-facebook"><a href="https://www.facebook.com/sharer/sharer.php?u={{ place_url id }}" target="_blank" data-shareto="facebook">Recommend on Facebook</a></li>
          </ul>
        </div>
      </section>

      <header class="place-header clearfix">
        <h1>{{ place_type_label location_type }}</h1>
        <span class="place-submission-details">
           <strong class="point-submitter">
            {{#if submitter.avatar_url }}
              <img src="{{ submitter.avatar_url }}" class="avatar" />
            {{^}}
              <img src="{{ STATIC_URL }}/css/images/user-50.png" class="avatar" />
            {{/if}}
            {{#if submitter.name }}
              {{ action_text }} by {{ submitter.name }}
            {{^}}
              {{#is submitter_name "Someone"}}
                {{^}}
                  {{ action_text }} by {{ submitter_name }}
              {{/is}}
            {{/if}}
          </strong>

          <time datetime="{{ created_datetime }}" class="response-date"><a href="/place/{{ id }}">{{ fromnow created_datetime }}</a></time>

          <span class="survey-count">{{ survey_count }} {{ survey_label_by_count }}</span>

          {{^if survey_config}}
          <a href="/place/{{ id }}" class="view-on-map-btn btn btn-small">View On Map</a>
          {{/if}}

        </span>
      </header>

      <section class="place-items">
        {{# attachments }}
        <div class="place-item place-item-attachment place-attachment-{{ name }}">
          <img src="{{ file }}" class="place-value place-value-{{ name }}" alt="{{ name }}">
        </div>
        {{/ attachments }}
        <div class="place-item place-item-description">
          <p class="place-value place-value-description">{{ description }}</p>
        </div>
      </section>

      {{#if survey_config}}
      <section class="survey" id="survey"></section>
      {{/if}}
    </script>

    <script id="place-summary" type="text/x-handlebars-template">
      <div class="place-summary-popup">
        {{# if submitter }}<img class="submitter-avatar" src="{{ submitter.avatar_url }}">{{/ if }}
        <h1>{{ place_type_label location_type }}</h1>
        <p>{{ truncate description 140 '...' }}</p>
      </div>
    </script>


    <script>
      Swag.registerHelpers();

      Shareabouts = Shareabouts || {};
      Shareabouts.Config = {
        placeTypes: {
          'notime': { label: 'Not Enough Time to Cross' },
          'doublepark': { label: 'Double Parking' },
          'longwait': { label: 'Long Wait to Cross' },
          'redlight': { label: 'Red Light Running' },
          'jaywalking': { label: 'Jaywalking' },
          'visibility': { label: 'Poor Visibility' },
          'speeding': { label: 'Speeding' },
          'longcross': { label: 'Long Distance to Cross' },
          'yield': { label: 'Failure to Yield' },
          'bike': { label: 'Cyclist Behavior' },
          'other': { label: 'Other' }
        }
      }

      function loadStreetView(lat, lng) {
        var sa = new Shareabouts.StreetView({
          el: '.shareabouts-streetview',
          map: {
            center: [lat, lng],
            maxDistance: '100m'
          },
          placeStyles: [
            {
              condition: '"{{location_type}}" == "doublepark"',
              icon: {
                url: 'styles/images/markers/marker-doublepark.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-doublepark.png'
              }
            },
            {
              condition: '"{{location_type}}" == "jaywalking"',
              icon: {
                url: 'styles/images/markers/marker-jaywalking.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-jaywalking.png'
              }
            },
            {
              condition: '"{{location_type}}" == "longcross"',
              icon: {
                url: 'styles/images/markers/marker-longcross.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-longcross.png'
              }
            },
            {
              condition: '"{{location_type}}" == "longwait"',
              icon: {
                url: 'styles/images/markers/marker-longwait.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-longwait.png'
              }
            },
            {
              condition: '"{{location_type}}" == "notime"',
              icon: {
                url: 'styles/images/markers/marker-notime.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-notime.png'
              }
            },
            {
              condition: '"{{location_type}}" == "redlight"',
              icon: {
                url: 'styles/images/markers/marker-redlight.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-redlight.png'
              }
            },
            {
              condition: '"{{location_type}}" == "speeding"',
              icon: {
                url: 'styles/images/markers/marker-speeding.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-speeding.png'
              }
            },
            {
              condition: '"{{location_type}}" == "visibility"',
              icon: {
                url: 'styles/images/markers/marker-visibility.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-visibility.png'
              }
            },
            {
              condition: '"{{location_type}}" == "yield"',
              icon: {
                url: 'styles/images/markers/marker-yield.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-yield.png'
              }
            },
            {
              condition: '"{{location_type}}" == "bike"',
              icon: {
                url: 'styles/images/markers/marker-bike.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-bike.png'
              }
            },
            {
              condition: '"{{location_type}}" == "other"',
              icon: {
                url: 'styles/images/markers/marker-unknown.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-unknown.png'
              }
            },
          ],

          datasetUrl: 'http://data.shareabouts.org/api/v2/nycdot/datasets/vz/places',
          addButtonLabel: 'Add a Place',

          // These are template functions that expect geojson.
          templates: {
            'place-summary': Handlebars.compile($('#place-summary').html()),
            'place-detail': Handlebars.compile($('#place-detail').html()),
            'place-form': function(data) {
              return '<p class="form-instructions">Drag the map to the place you want to share.</p>' +
                '<h2>Add a Place</h2>' +
                '<form novalidate>' +
                '<p><label>Your Name<input type="text" name="submitter_name" required /></label></p>' +
                '<p><label>Your Email<input type="text" name="private-email" /></label></p>' +
                '<p><label>Title<input type="text" name="name" required /></label></p>' +
                '<p><label>Description<textarea name="description" required></textarea></label></p>' +
                '<p><input type="submit" value="Add to Map"></p>'
                '</form>'
            }
          }
        });
      }

      loadStreetView(40.7210690835, -73.9981985092);

      // Make a new map, and recenter when we click.
      map = L.map($('.shareabouts-location-map').get(0), {center: [40.7210690835, -73.9981985092], zoom: 14});
      layerOptions = {
        url: 'http://{s}.tiles.mapbox.com/v3/openplans.map-dmar86ym/{z}/{x}/{y}.png',
        attribution: '&copy; OpenStreetMap contributors, CC-BY-SA. <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
      };
      L.tileLayer(layerOptions.url, layerOptions).addTo(map);

      map.on('click', function(evt) {
        var lat = evt.latlng.lat,
            lng = evt.latlng.lng;

        loadStreetView(lat, lng);
      })

    </script>

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-XXXXX-X');ga('send','pageview');
    </script>

    <!-- build:js({app,.tmp}) scripts/main.js -->
    <script src="scripts/main.js"></script>
    <!-- endbuild -->
</body>
</html>

<!doctype html>
<!--[if lt IE 7]>  <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>shareabouts sv vision zero</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <link href="bower_components/shareabouts-js/src/styles/shareabouts.css" rel="stylesheet" />
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
    <script src="bower_components/modernizr/modernizr.js"></script>

  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <div class="shareabouts-location-map"></div>
    <div class="shareabouts-streetview-container">
      <div class="shareabouts-streetview-map"></div>
      <div class="shareabouts-streetview"></div>
    </div>

    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/1.8.0/backbone.marionette.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false" type="text/javascript"></script>

    <script src="//rawgit.com/openplans/gatekeeper/gh-pages/gatekeeper.js"></script>

    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/handlebars/handlebars.js"></script>
    <script src="bower_components/swag/lib/swag.js"></script>
    <script src="bower_components/moment/moment.js"></script>
    <script src="bower_components/shareabouts-js/src/utils.js"></script>
    <script src="bower_components/shareabouts-js/src/models.js"></script>
    <script src="bower_components/shareabouts-js/src/streetview.js"></script>

    <script src="scripts/handlebars-helpers.js"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <script id="place-detail" type="text/x-handlebars-template">
      <section class="promotion clearfix">
        <div class="support"></div>
        <div class="social">
          <ul class="sharing unstyled-list">
            <li class="share-link share-twitter"><a href="https://twitter.com/intent/tweet?hashtags=VisionZero&url={{ place_url id }}&text=I shared my knowledge to help make Vision Zero a reality in NYC" target="_blank" data-shareto="twitter">Tweet This</a></li>
            <li class="share-link share-facebook"><a href="https://www.facebook.com/sharer/sharer.php?u={{ place_url id }}" target="_blank" data-shareto="facebook">Recommend on Facebook</a></li>
          </ul>
        </div>
      </section>

      <header class="place-header clearfix">
        <h1>{{ place_type_label location_type }}</h1>
        <span class="place-submission-details">
           <strong class="point-submitter">
            {{#if submitter.avatar_url }}
              <img src="{{ submitter.avatar_url }}" class="avatar" />
            {{^}}
              <img src="styles/images/user-50.png" class="avatar" />
            {{/if}}
            {{#if submitter.name }}
              {{ action_text }} by {{ submitter.name }}
            {{^}}
              {{#is submitter_name "Someone"}}
                {{^}}
                  {{ action_text }} by {{ submitter_name }}
              {{/is}}
            {{/if}}
          </strong>

          <time datetime="{{ created_datetime }}" class="response-date"><a href="/place/{{ id }}">{{ fromnow created_datetime }}</a></time>

          <span class="survey-count">{{ survey_count }} {{ survey_label_by_count }}</span>

          {{^if survey_config}}
          <a href="/place/{{ id }}" class="view-on-map-btn btn btn-small">View On Map</a>
          {{/if}}

        </span>
      </header>

      <section class="place-items">
        {{# attachments }}
        <div class="place-item place-item-attachment place-attachment-{{ name }}">
          <img src="{{ file }}" class="place-value place-value-{{ name }}" alt="{{ name }}">
        </div>
        {{/ attachments }}
        <div class="place-item place-item-description">
          <p class="place-value place-value-description">{{ description }}</p>
        </div>
      </section>

      {{#if survey_config}}
      <section class="survey" id="survey"></section>
      {{/if}}
    </script>

    <script id="place-summary" type="text/x-handlebars-template">
      <div class="place-summary-popup">
        {{# if submitter }}<img class="submitter-avatar" src="{{ submitter.avatar_url }}">{{/ if }}
        <h1>{{ place_type_label location_type }}</h1>
        <p>{{ truncate description 140 '...' }}</p>
      </div>
    </script>

    <script id="place-form" type="text/x-handlebars-template">
      <p class="form-instructions">Drag the map to the location of the issue.</p>

      <h4>Describe the issue</h4>

      <form class="place-form clearfix">
        <fieldset>
          <input type="hidden" name="visible" value="on">
          <!-- TODO: ??? -->
          <input type="hidden" name="user_token" value="{{{ user_token }}}">

          <div class="text form-item-container">
            <label for="place-submitter_name">Your Name <small>(optional)</small></label>
            <input id="place-submitter_name" name="submitter_name" type="text" placeholder="Name" size="30">
          </div>

          <div class="text form-item-container">
            <label for="place-location_type">Observed issue </label>
            <ul class="place-type-list place-type-selector unstyled-list">
              <li class="prompt active">Please choose a category&hellip;</li>
              <li data-value="notime"><img src="styles/images/icon-notime.png">&nbsp;<strong>Not Enough Time to Cross</strong></li>
              <li data-value="doublepark"><img src="styles/images/icon-doublepark.png">&nbsp;<strong>Double Parking</strong></li>
              <li data-value="longwait"><img src="styles/images/icon-longwait.png">&nbsp;<strong>Long Wait to Cross</strong></li>
              <li data-value="redlight"><img src="styles/images/icon-redlight.png">&nbsp;<strong>Red Light Running</strong></li>
              <li data-value="jaywalking"><img src="styles/images/icon-jaywalking.png">&nbsp;<strong>Jaywalking</strong></li>
              <li data-value="visibility"><img src="styles/images/icon-visibility.png">&nbsp;<strong>Poor Visibility</strong></li>
              <li data-value="speeding"><img src="styles/images/icon-speeding.png">&nbsp;<strong>Speeding</strong></li>
              <li data-value="longcross"><img src="styles/images/icon-longcross.png">&nbsp;<strong>Long Distance to Cross</strong></li>
              <li data-value="yield"><img src="styles/images/icon-yield.png">&nbsp;<strong>Failure to Yield</strong></li>
              <li data-value="bike"><img src="styles/images/icon-bike.png">&nbsp;<strong>Cyclist Behavior</strong></li>
              <li data-value="other"><img src="styles/images/icon-unknown.png">&nbsp;<strong>Other</strong></li>
            </ul>
            <input type="hidden" name="location_type" value="other">

            <p class="other-type-instructions">Suggestions on this site will be used for a safety plan. Have a street defect or faded marking you would like repaired? Contact <a href="http://www.nyc.gov/html/dot/html/contact/contact-form.shtml">DOT</a> or call <a href="http://nyc.gov/311">311</a>.</p>
          </div>

          <div class="textarea form-item-container">
            <label for="place-description">Provide more information about the issue <small class="is-hidden">(optional)</small></label>
            <textarea id="place-description" name="description" placeholder="Description..." required></textarea>
          </div>

          <div class="text form-item-container">
            <label for="place-private-submitter_email">Your Email <small>(optional)</small></label>
            <input id="place-private-submitter_email" name="private-submitter_email" type="text" placeholder="Email address" size="30">
          </div>

          <input name="save-place-btn" type="submit" value="Put on map" class="btn btn-primary submit-btn">
        </fieldset>

        <div class="form-spinner"></div>
      </form>
    </script>


    <script>
      Swag.registerHelpers();

      Shareabouts = Shareabouts || {};
      Shareabouts.Config = {
        placeTypes: {
          'notime': { label: 'Not Enough Time to Cross' },
          'doublepark': { label: 'Double Parking' },
          'longwait': { label: 'Long Wait to Cross' },
          'redlight': { label: 'Red Light Running' },
          'jaywalking': { label: 'Jaywalking' },
          'visibility': { label: 'Poor Visibility' },
          'speeding': { label: 'Speeding' },
          'longcross': { label: 'Long Distance to Cross' },
          'yield': { label: 'Failure to Yield' },
          'bike': { label: 'Cyclist Behavior' },
          'other': { label: 'Other' }
        }
      }

      function loadStreetView(lat, lng) {
        var sa = new Shareabouts.StreetView({
          el: '.shareabouts-streetview',
          map: {
            center: [lat, lng],
            maxDistance: '100m'
          },
          placeStyles: [
            {
              condition: '"{{location_type}}" == "doublepark"',
              icon: {
                url: 'styles/images/markers/marker-doublepark.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-doublepark.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "jaywalking"',
              icon: {
                url: 'styles/images/markers/marker-jaywalking.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-jaywalking.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "longcross"',
              icon: {
                url: 'styles/images/markers/marker-longcross.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-longcross.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "longwait"',
              icon: {
                url: 'styles/images/markers/marker-longwait.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-longwait.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "notime"',
              icon: {
                url: 'styles/images/markers/marker-notime.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-notime.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "redlight"',
              icon: {
                url: 'styles/images/markers/marker-redlight.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-redlight.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "speeding"',
              icon: {
                url: 'styles/images/markers/marker-speeding.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-speeding.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "visibility"',
              icon: {
                url: 'styles/images/markers/marker-visibility.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-visibility.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "yield"',
              icon: {
                url: 'styles/images/markers/marker-yield.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-yield.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "bike"',
              icon: {
                url: 'styles/images/markers/marker-bike.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-bike.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: '"{{location_type}}" == "other"',
              icon: {
                url: 'styles/images/markers/marker-unknown.png'
              },
              focusIcon: {
                url: 'styles/images/markers/marker-unknown.png',
                scaledSize: new google.maps.Size(81, 120)
              }
            },
            {
              condition: 'true',
              newIcon: {
                url: 'styles/images/marker-plus-shadowed.png'
              }
            }
          ],

          datasetUrl: 'http://data.shareabouts.org/api/v2/nycdot/datasets/vz-dev/places',
          addButtonLabel: 'Add a Place',
          maxDistance: 25,

          // These are template functions that expect geojson.
          templates: {
            'place-summary': Handlebars.compile($('#place-summary').html()),
            'place-detail': Handlebars.compile($('#place-detail').html()),
            'place-form': Handlebars.compile($('#place-form').html())
          }
        });
      }

      loadStreetView(40.7210690835, -73.9981985092);

      // Make a new map, and recenter when we click.
      map = L.map($('.shareabouts-location-map').get(0), {center: [40.7210690835, -73.9981985092], zoom: 14});
      layerOptions = {
        url: 'http://{s}.tiles.mapbox.com/v3/openplans.map-dmar86ym/{z}/{x}/{y}.png',
        attribution: '&copy; OpenStreetMap contributors, CC-BY-SA. <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
      };
      L.tileLayer(layerOptions.url, layerOptions).addTo(map);

      map.on('click', function(evt) {
        var lat = evt.latlng.lat,
            lng = evt.latlng.lng;

        loadStreetView(lat, lng);
      })

    </script>

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-XXXXX-X');ga('send','pageview');
    </script>

    <!-- build:js({app,.tmp}) scripts/main.js -->
    <script src="scripts/main.js"></script>
    <!-- endbuild -->
</body>
</html>
